<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ClubConnect – Super Admin Dashboard</title>

  <!-- Base theme (same as homepage) -->
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Force light dashboard look (white cards, dark text) */
    .dashboard-theme {
      --color-surface: #ffffff;
      --color-text: #111827;
      --color-text-secondary: #6b7280;
      --color-card-border: rgba(15, 23, 42, 0.08);
      --color-border: rgba(15, 23, 42, 0.08);

      background-color: #f5f5f5;
      color: var(--color-text);
    }

    body {
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* Layout: header + sidebar + main */
    .dashboard-layout {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      min-height: calc(100vh - 72px); /* minus header */
      margin-top: 4.5rem;
    }

    @media (max-width: 900px) {
      .dashboard-layout {
        grid-template-columns: 1fr;
      }
    }

    /* Sidebar */
    .dashboard-sidebar {
      background: linear-gradient(180deg, #155598, #1b3358);
      color: #fff;
      padding: 1.5rem 1.3rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .sidebar-title {
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .sidebar-title i {
      font-size: 1.2rem;
    }

    .sidebar-user {
      padding: 0.9rem 0.8rem;
      border-radius: 1rem;
      background-color: rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
    }

    .sidebar-user-meta {
      font-size: 0.8rem;
      line-height: 1.2;
    }

    .sidebar-user-meta strong {
      display: block;
      font-size: 0.88rem;
    }

    .sidebar-user-meta span {
      color: rgba(255,255,255,0.8);
    }

    .sidebar-nav {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .sidebar-link {
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.55rem;
      border: 1px solid transparent;
      cursor: pointer;
      background-color: transparent;
      color: rgba(255,255,255,0.88);
      text-align: left;
    }

    .sidebar-link i {
      font-size: 0.95rem;
      width: 18px;
      text-align: center;
    }

    .sidebar-link.active,
    .sidebar-link:hover {
      background-color: rgba(255,255,255,0.14);
      border-color: rgba(255,255,255,0.3);
      color: #ffffff;
    }

    /* Main content */
    .dashboard-main {
      padding: 2rem 2.3rem;
    }

    @media (max-width: 900px) {
      .dashboard-main {
        padding: 1.5rem 1rem 3rem;
      }
    }

    .view-header {
      margin-bottom: 1.3rem;
    }

    .view-header h1 {
      font-size: 2.1rem;
      margin: 0 0 0.4rem;
      color: var(--color-text);
    }

    .view-header p {
      margin: 0;
      font-size: 0.98rem;
      color: var(--color-text-secondary);
      max-width: 680px;
    }

    /* Big card per view */
    .dashboard-card {
      background-color: var(--color-surface);
      border-radius: 1.25rem;
      border: 1px solid var(--color-card-border);
      box-shadow: var(--shadow-sm);
      padding: 1.8rem 2rem;
    }

    @media (max-width: 900px) {
      .dashboard-card {
        padding: 1.4rem 1.3rem;
      }
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.1rem;
    }

    .card-title-main {
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }

    .card-title-main i {
      font-size: 1.1rem;
      color: var(--clr-primary);
    }

    .card-title-main h2 {
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      margin: 0;
    }

    .card-chip {
      font-size: 0.78rem;
      padding: 0.23rem 0.7rem;
      border-radius: 999px;
      background-color: rgba(21, 101, 192, 0.08);
      color: var(--clr-primary);
      white-space: nowrap;
    }

    .card-subtext {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
      margin-bottom: 1.1rem;
    }

    /* Generic form stuff */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem 1.5rem;
      margin-bottom: 1.2rem;
    }

    .form-group label {
      display: block;
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      margin-bottom: 0.18rem;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.55rem 0.65rem;
      border-radius: 0.7rem;
      border: 1px solid var(--color-border-secondary);
      font-size: 0.9rem;
      outline: none;
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-hint {
      font-size: 0.82rem;
      color: var(--color-text-secondary);
      margin-top: 0.4rem;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 0.3rem;
    }

    .btn-pill {
      border-radius: 999px;
      border: 1px solid var(--color-border-secondary);
      background-color: #ffffff;
      padding: 0.35rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .btn-pill-primary {
      border-color: var(--clr-primary);
      background-color: var(--clr-primary);
      color: #ffffff;
    }

    .btn-pill-danger {
      border-color: rgba(192, 21, 47, 0.7);
      background-color: rgba(192, 21, 47, 0.9);
      color: #ffffff;
    }

    .btn-pill-ghost {
      background-color: #ffffff;
    }

    /* KPI row on overview */
    .kpi-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 1rem;
      margin-bottom: 1.4rem;
    }

    .kpi-card {
      border-radius: 1rem;
      border: 1px solid rgba(15,23,42,0.06);
      padding: 0.9rem 1rem;
      background-color: #f9fafb;
    }

    .kpi-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--color-text-secondary);
      margin-bottom: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .kpi-label i {
      color: var(--clr-primary);
    }

    .kpi-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: 0.15rem;
    }

    .kpi-meta {
      font-size: 0.8rem;
      color: var(--color-text-secondary);
    }

    /* Simple tables */
    .simple-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    .simple-table th,
    .simple-table td {
      padding: 0.55rem 0.4rem;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      text-align: left;
    }

    .simple-table th {
      font-size: 0.8rem;
      text-transform: uppercase;
      color: var(--color-text-secondary);
      letter-spacing: 0.06em;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.78rem;
    }

    .status-pill--live {
      background-color: rgba(33,128,141,0.12);
      color: var(--color-success);
    }

    .status-pill--pending {
      background-color: rgba(245,158,11,0.12);
      color: rgb(180, 83, 9);
    }

    .status-pill--draft {
      background-color: rgba(107,114,128,0.12);
      color: rgb(55,65,81);
    }

    .status-pill--completed {
      background-color: rgba(55,65,81,0.15);
      color: rgb(31,41,55);
    }

    .badge-muted {
      font-size: 0.78rem;
      color: var(--color-text-secondary);
    }

    /* Chart areas */
    .chart-wrapper {
      margin-top: 1rem;
      height: 260px;
    }

    .chart-wrapper canvas {
      width: 100% !important;
      height: 100% !important;
    }

    /* Complaints list */
    .complaints-list {
      list-style: none;
      margin: 0.6rem 0 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      font-size: 0.88rem;
    }

    .complaint-item {
      border-radius: 0.9rem;
      border: 1px solid rgba(0,0,0,0.05);
      background-color: #fafafa;
      padding: 0.7rem 0.8rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.7rem;
    }

    .complaint-main {
      max-width: 70%;
    }

    .complaint-meta {
      font-size: 0.8rem;
      color: var(--color-text-secondary);
      margin-top: 0.15rem;
    }

    .complaint-actions {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    /* Views */
    .view { display: none; }
    .view.active { display: block; }

    /* Ensure header/nav readable */
    .header,
    .nav-link,
    .btn-login {
      color: black;
    }
  </style>
</head>
<body>
  <!-- Source Code Protection 
  <script src="protection.js"></script>-->
  <!-- Top header (same structure as homepage) -->
  
  <header class="header" id="header">
  <nav class="nav container">
    <div class="nav-logo">
  <a href="index.html">
      <img src="logo.png" alt="ClubConnect Logo" class="logo-img">
  </a>
</div>

    <div class="nav-right">
      <ul class="nav-menu" id="navMenu">
        <li class="nav-item">
          <a href="index.html" class="nav-link active">Home</a>
        </li>
        <li class="nav-item">
          <a href="features.html" class="nav-link">Features</a>
        </li>
        <li class="nav-item">
          <a href="#programs" class="nav-link">Programs</a>
        </li>
        <li class="nav-item">
          <a href="teams.html" class="nav-link">Teams</a>
        </li>
        <li class="nav-item">
          <a href="#pricing" class="nav-link">Pricing</a>
        </li>
        <li class="nav-item">
          <a href="leaderboards.html" class="nav-link">Leaderboards</a>
        </li>
        <li class="nav-item">
          <a href="contact.html" class="nav-link">Contact</a>
        </li>
      <button class="btn btn-login" id="adminLogoutTopBtn">Logout</button>
      
    </div>
    <div class="nav-toggle" id="navToggle">
      <i class="fas fa-bars"></i>
    </div>
  </nav>
</header>

  <!-- DASHBOARD LAYOUT -->
  <div class="dashboard-layout dashboard-theme" id="adminDashboardLayout" style="display:none;">
    <!-- SIDEBAR -->
    <aside class="dashboard-sidebar">
      <div class="sidebar-title">
        <i class="fas fa-crown"></i>
        <span>Super Admin Panel</span>
      </div>

      <div class="sidebar-user">
        <div class="sidebar-avatar" id="adminAvatarInitial">SA</div>
        <div class="sidebar-user-meta">
          <strong id="adminUserName">Super Admin</strong>
          <span id="adminEmailLabel">superadmin@clubconnect.com</span>
        </div>
      </div>

      <nav class="sidebar-nav">
        <button class="sidebar-link active" data-view-target="overview">
          <i class="fas fa-gauge"></i> Overview
        </button>
        <button class="sidebar-link" data-view-target="leagues">
          <i class="fas fa-trophy"></i> Leagues
        </button>
        <button class="sidebar-link" data-view-target="venues">
          <i class="fas fa-map-location-dot"></i> Venues
        </button>
        <button class="sidebar-link" data-view-target="clubs">
          <i class="fas fa-shield"></i> Clubs
        </button>
        <button class="sidebar-link" data-view-target="users">
          <i class="fas fa-users-gear"></i> Users
        </button>
        <button class="sidebar-link" data-view-target="payments">
  <i class="fas fa-coins"></i> Payments
</button>

        <button class="sidebar-link" data-view-target="revenue">
          <i class="fas fa-coins"></i> Revenue
        </button>
        <button class="sidebar-link" data-view-target="complaints">
          <i class="fas fa-bell"></i> Reports & Complaints
        </button>
      </nav>
    </aside>

    <!-- MAIN AREA -->
    <main class="dashboard-main">
      <!-- OVERVIEW -->
      <section class="view active" id="view-overview">
        <div class="view-header">
          <h1>Overview</h1>
          <p>A bird’s eye view of all leagues, clubs, users and revenue running on ClubConnect.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-gauge-high"></i>
              <h2>PLATFORM OVERVIEW</h2>
            </div>
            <span class="card-chip">Global snapshot</span>
          </div>

          <div class="kpi-row">
            <div class="kpi-card">
              <div class="kpi-label"><i class="fas fa-trophy"></i> Active leagues</div>
              <div class="kpi-value">6</div>
              <div class="kpi-meta">Football, Cricket, Basketball, Hockey</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label"><i class="fas fa-shield-alt"></i> Total clubs</div>
              <div class="kpi-value">128</div>
              <div class="kpi-meta">112 active • 16 pending / suspended</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label"><i class="fas fa-users"></i> Registered users</div>
              <div class="kpi-value">2,374</div>
              <div class="kpi-meta">Owners • Coaches • Players</div>
            </div>
            <div class="kpi-card">
              <div class="kpi-label"><i class="fas fa-coins"></i> Monthly revenue</div>
              <div class="kpi-value">₨ 842k</div>
              <div class="kpi-meta">Registration + league fees</div>
            </div>
          </div>

          <p class="card-subtext">
            Use the left navigation to jump into detailed views: create leagues, approve clubs, manage users, assign venues and monitor revenue.
          </p>
        </div>
      </section>

      <!-- LEAGUES -->
      <section class="view" id="view-leagues">
        <div class="view-header">
          <h1>Leagues Management</h1>
          <p>Create & control tournaments, add sponsors, and view basic analytics.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-trophy"></i>
              <h2>LEAGUES</h2>
            </div>
            <span class="card-chip">Creation & control</span>
          </div>

          <p class="card-subtext">
            Define tournaments that clubs will enroll into. Later this screen will generate brackets and automatically assign venues.
          </p>

          <!-- League creation form (UI only now) -->
          <div class="form-grid">
            <div class="form-group">
              <label for="leagueNameInput">League name</label>
              <input id="leagueNameInput" type="text" placeholder="e.g. Capital Football Premier">
            </div>
            <div class="form-group">
              <label for="leagueSportSelect">Sport</label>
              <select id="leagueSportSelect">
                <option value="">Select sport…</option>
                <option>Football</option>
                <option>Cricket</option>
                <option>Basketball</option>
                <option>Hockey</option>
              </select>
            </div>
            <div class="form-group">
              <label for="leagueStartDate">Start date</label>
              <input id="leagueStartDate" type="date">
            </div>
            <div class="form-group">
              <label for="leagueDeadline">Enrollment deadline</label>
              <input id="leagueDeadline" type="date">
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="leagueSponsorInput">Main sponsor</label>
              <input id="leagueSponsorInput" type="text" placeholder="e.g. Puma, Pepsi, etc.">
            </div>
            <div class="form-group">
              <label for="leagueNotes">Notes / rules</label>
              <textarea id="leagueNotes" placeholder="Short description, format, rules etc."></textarea>
            </div>
          </div>

          <div class="btn-row">
            <button class="btn-pill btn-pill-primary" id="createLeagueBtn">
              <i class="fas fa-plus-circle"></i> Create league
            </button>
          </div>

          <div class="form-hint">
            Later this will create a document in Firestore (e.g. <strong>leagues</strong> collection) and generate fixtures.
          </div>

          <hr style="margin:1.3rem 0; border:none; border-top:1px solid rgba(0,0,0,0.06);">

          <table class="simple-table" id="leaguesTable">
            <thead>
              <tr>
                <th>League</th>
                <th>Sport</th>
                <th>Status</th>
                <th>Teams</th>
                <th>Starts</th>
                <th>Sponsor</th>
              </tr>
            </thead>
            <tbody>
              <tr data-status="live">
                <td>Capital Football Premier</td>
                <td>Football</td>
                <td><span class="status-pill status-pill--live"><i class="fas fa-circle"></i> Live</span></td>
                <td>16</td>
                <td>Mar 12</td>
                <td>Puma</td>
              </tr>
              <tr data-status="enrollment">
                <td>NUCES Super Sixes</td>
                <td>Cricket</td>
                <td><span class="status-pill status-pill--pending"><i class="fas fa-clock"></i> Enrollment</span></td>
                <td>10</td>
                <td>Apr 02</td>
                <td>Tapal</td>
              </tr>
              <tr data-status="completed">
                <td>Islamabad Hoop League</td>
                <td>Basketball</td>
                <td><span class="status-pill status-pill--completed"><i class="fas fa-flag-checkered"></i> Completed</span></td>
                <td>8</td>
                <td>Jan 05</td>
                <td>Nike</td>
              </tr>
              <tr data-status="draft">
                <td>Twin Cities Hockey Cup</td>
                <td>Hockey</td>
                <td><span class="status-pill status-pill--draft"><i class="fas fa-pen"></i> Draft</span></td>
                <td>–</td>
                <td>TBD</td>
                <td>–</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <section class="view" id="view-payments">
  <div class="view-header">
    <h1>Pending Payments</h1>
    <p>Approve or reject registrations paid via crypto.</p>
  </div>

  <div class="dashboard-card">
    <div class="card-title-row">
      <div class="card-title-main">
        <i class="fas fa-coins"></i>
        <h2>PENDING REGISTRATIONS</h2>
      </div>
      <span class="card-chip">SuperAdmin only</span>
    </div>

    <table class="simple-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Paid?</th>
          <th>Enabled?</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="pendingPaymentsTableBody">
        <!-- rows injected by JS -->
      </tbody>
    </table>

    <div class="form-hint">
      Showing users who paid (crypto) but are not yet enabled.
    </div>
  </div>
</section>

      <!-- VENUES -->
      <section class="view" id="view-venues">
        <div class="view-header">
          <h1>Grounds & Venues</h1>
          <p>Manage grounds that you own or have access to, which can be auto-assigned to leagues.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-map-location-dot"></i>
              <h2>VENUES</h2>
            </div>
            <span class="card-chip">Home of fixtures</span>
          </div>

          <p class="card-subtext">
            These venues will later be used by the fixture generator to auto-assign matches based on sport, time slots and location.
          </p>

          <table class="simple-table" id="venuesTable">
            <thead>
              <tr>
                <th>Venue</th>
                <th>City</th>
                <th>Surface</th>
                <th>Slots/day</th>
                <th>Assigned leagues</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>FAST Arena Ground</td>
                <td>Islamabad</td>
                <td>Turf</td>
                <td>6</td>
                <td><span class="badge-muted">2 leagues</span></td>
              </tr>
              <tr>
                <td>Jinnah Stadium</td>
                <td>Islamabad</td>
                <td>Grass</td>
                <td>4</td>
                <td><span class="badge-muted">1 league</span></td>
              </tr>
              <tr>
                <td>Blue Court Sports Complex</td>
                <td>Rawalpindi</td>
                <td>Indoor</td>
                <td>8</td>
                <td><span class="badge-muted">Training + matches</span></td>
              </tr>
              <tr>
                <td>Margalla Hockey Center</td>
                <td>Islamabad</td>
                <td>Astro</td>
                <td>5</td>
                <td><span class="badge-muted">Hockey only</span></td>
              </tr>
            </tbody>
          </table>

          <hr style="margin:1.3rem 0; border:none; border-top:1px solid rgba(0,0,0,0.06);">

          <div class="form-grid">
  <div class="form-group">
    <label for="venueNameInput">Add new venue</label>
    <input id="venueNameInput" type="text" placeholder="Venue name">
  </div>
  <div class="form-group">
    <label for="venueCityInput">City</label>
    <input id="venueCityInput" type="text" placeholder="City">
  </div>
  <div class="form-group">
    <label for="venueSurfaceInput">Surface</label>
    <input id="venueSurfaceInput" type="text" placeholder="Grass, Turf, Indoor, Astro">
  </div>
  <div class="form-group">
    <label for="venueSlotsInput">Slots per day</label>
    <input id="venueSlotsInput" type="number" placeholder="e.g. 6">
  </div>
  <div class="form-group">
    <label for="venueImageInput">Venue image (optional)</label>
    <input id="venueImageInput" type="file" accept="image/*">
  </div>
</div>

<div class="btn-row">
  <button class="btn-pill btn-pill-primary" id="addVenueBtn">
    <i class="fas fa-plus"></i> Add venue
  </button>
</div>

        </div>
      </section>

      <!-- CLUBS -->
      <section class="view" id="view-clubs">
        <div class="view-header">
          <h1>Clubs</h1>
          <p>Review, approve, suspend or reject clubs. Monitor active vs inactive clubs.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-shield-alt"></i>
              <h2>CLUBS</h2>
            </div>
            <span class="card-chip">Approval & suspension</span>
          </div>

          <p class="card-subtext">
            New clubs appear as <strong>Pending</strong>. You can approve, reject, or suspend any club at any time.
          </p>

          <table class="simple-table" id="clubsTable">
            <thead>
              <tr>
                <th>Club</th>
                <th>Owner</th>
                <th>Sport</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr data-status="active">
                <td>Margalla United FC</td>
                <td>Ahmad Khan</td>
                <td>Football</td>
                <td><span class="status-pill status-pill--live"><i class="fas fa-check"></i> Active</span></td>
                <td>
                  <div class="btn-row">
                    <button class="btn-pill btn-pill-danger btn-suspend-club"><i class="fas fa-ban"></i> Suspend</button>
                  </div>
                </td>
              </tr>
              <tr data-status="pending">
                <td>Rawal Kings Cricket</td>
                <td>Bilal Mehmood</td>
                <td>Cricket</td>
                <td><span class="status-pill status-pill--pending"><i class="fas fa-clock"></i> Pending</span></td>
                <td>
                  <div class="btn-row">
                    <button class="btn-pill btn-pill-primary btn-approve-club"><i class="fas fa-check"></i> Approve</button>
                    <button class="btn-pill btn-pill-danger btn-reject-club"><i class="fas fa-xmark"></i> Reject</button>
                  </div>
                </td>
              </tr>
              <tr data-status="suspended">
                <td>City Hoop Club</td>
                <td>Umer Shah</td>
                <td>Basketball</td>
                <td><span class="status-pill status-pill--draft"><i class="fas fa-ban"></i> Suspended</span></td>
                <td>
                  <button class="btn-pill btn-pill-primary btn-restore-club"><i class="fas fa-undo"></i> Restore</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- USERS -->
      <section class="view" id="view-users">
        <div class="view-header">
          <h1>Users</h1>
          <p>Manage all roles: Super Admin, Club Owners, Coaches and Players. Block or unblock accounts.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-users-gear"></i>
              <h2>USERS</h2>
            </div>
            <span class="card-chip">Role-based management</span>
          </div>

          <p class="card-subtext">
            You can filter by role and toggle user status. In future this will be powered by real data from Firestore.
          </p>

          <div class="btn-row" style="margin-bottom:0.8rem;">
            <button class="btn-pill btn-pill-primary" data-role-filter="all">All</button>
            <button class="btn-pill btn-pill-ghost" data-role-filter="super_admin">Super Admins</button>
            <button class="btn-pill btn-pill-ghost" data-role-filter="club_owner">Club Owners</button>
            <button class="btn-pill btn-pill-ghost" data-role-filter="coach">Coaches</button>
            <button class="btn-pill btn-pill-ghost" data-role-filter="player">Players</button>
          </div>

          <table class="simple-table" id="usersTable">
            <thead>
              <tr>
                <th>User</th>
                <th>Role</th>
                <th>Club</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr data-role="super_admin" data-blocked="false">
                <td>Platform Root Admin</td>
                <td>Super Admin</td>
                <td>–</td>
                <td><span class="badge-muted">Active</span></td>
                <td>–</td>
              </tr>
              <tr data-role="club_owner" data-blocked="false">
                <td>Ali Raza</td>
                <td>Club Owner</td>
                <td>Margalla United FC</td>
                <td><span class="badge-muted">Active</span></td>
                <td>
                  <button class="btn-pill btn-pill-danger btn-block-user">
  <i class="fas fa-ban"></i> Block
</button>
<button class="btn-pill btn-pill-ghost btn-unblock-user">
  <i class="fas fa-unlock"></i> Unblock
</button>
<button class="btn-pill btn-pill-danger btn-delete-user">
  <i class="fas fa-trash"></i> Delete
</button>

                </td>
              </tr>
              <tr data-role="coach" data-blocked="true">
                <td>Coach Imran</td>
                <td>Coach</td>
                <td>Rawal Kings Cricket</td>
                <td><span class="badge-muted">Blocked</span></td>
                <td>
                  <button class="btn-pill btn-pill-danger btn-block-user">
  <i class="fas fa-ban"></i> Block
</button>
<button class="btn-pill btn-pill-ghost btn-unblock-user">
  <i class="fas fa-unlock"></i> Unblock
</button>
<button class="btn-pill btn-pill-danger btn-delete-user">
  <i class="fas fa-trash"></i> Delete
</button>

                </td>
              </tr>
              <tr data-role="player" data-blocked="false">
                <td>Hamza Khan</td>
                <td>Player</td>
                <td>City Hoop Club</td>
                <td><span class="badge-muted">Active</span></td>
                <td>
                  <button class="btn-pill btn-pill-danger btn-block-user">
  <i class="fas fa-ban"></i> Block
</button>
<button class="btn-pill btn-pill-ghost btn-unblock-user">
  <i class="fas fa-unlock"></i> Unblock
</button>
<button class="btn-pill btn-pill-danger btn-delete-user">
  <i class="fas fa-trash"></i> Delete
</button>

                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- REVENUE -->
      <section class="view" id="view-revenue">
        <div class="view-header">
          <h1>Revenue & Payments</h1>
          <p>Track monthly revenue, registration fees and league payments with a simple graph.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-coins"></i>
              <h2>REVENUE</h2>
            </div>
            <span class="card-chip">High-level tracker</span>
          </div>

          <p class="card-subtext">
            Data below is sample for UI. Later it will be driven from real registrations and league enrollments (including crypto payments).
          </p>

          <div class="chart-wrapper">
            <canvas id="revenueChart"></canvas>
          </div>

          <div class="form-hint">
            Line chart shows monthly revenue in PKR and number of paid registrations.
          </div>
        </div>
      </section>

      <!-- COMPLAINTS -->
      <section class="view" id="view-complaints">
        <div class="view-header">
          <h1>Reports & Complaints</h1>
          <p>Central inbox for complaints from all users: club owners, coaches and players.</p>
        </div>

        <div class="dashboard-card">
          <div class="card-title-row">
            <div class="card-title-main">
              <i class="fas fa-bell"></i>
              <h2>COMPLAINTS</h2>
            </div>
            <span class="card-chip">Cross-role inbox</span>
          </div>

          <p class="card-subtext">
            Each complaint will eventually have severity, status and linked entities (league, match, club). For now this is UI + dummy interactions.
          </p>

          <ul class="complaints-list" id="complaintsList">
            <li class="complaint-item" data-status="open">
              <div class="complaint-main">
                <strong>Player · Hamza</strong> – “Fixture clashes with university exam schedule for our team.”
                <div class="complaint-meta">From: Player • League: NUCES Super Sixes • 12 min ago • Severity: Medium</div>
              </div>
              <div class="complaint-actions">
                <button class="btn-pill btn-pill-primary btn-mark-resolved"><i class="fas fa-check"></i> Mark resolved</button>
                <button class="btn-pill btn-pill-ghost btn-escalate"><i class="fas fa-arrow-up-right-from-square"></i> Escalate</button>
              </div>
            </li>
            <li class="complaint-item" data-status="open">
              <div class="complaint-main">
                <strong>Club Owner · Margalla United</strong> – “Payment status not updated for our last league enrollment.”
                <div class="complaint-meta">From: Club Owner • Payment module • 54 min ago • Severity: High</div>
              </div>
              <div class="complaint-actions">
                <button class="btn-pill btn-pill-primary btn-mark-resolved"><i class="fas fa-check"></i> Mark resolved</button>
                <button class="btn-pill btn-pill-ghost btn-escalate"><i class="fas fa-arrow-up-right-from-square"></i> Escalate</button>
              </div>
            </li>
            <li class="complaint-item" data-status="resolved">
              <div class="complaint-main">
                <strong>Coach · City Hoop</strong> – “Need announcement feature for last-minute training changes.”
                <div class="complaint-meta">From: Coach • Announcements • Resolved</div>
              </div>
              <div class="complaint-actions">
                <span class="badge-muted">Resolved</span>
              </div>
            </li>
          </ul>
        </div>
      </section>
    </main>
  </div>

  <!-- Back to top button -->
  <button class="back-to-top" id="backToTop">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Site-wide JS (nav, back-to-top etc.) -->
  <script src="app.js"></script>

  <!-- Firebase + Auth Guard + Dashboard Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    collection,
    doc,
    getDoc,
    onSnapshot,
    query,
    where,
    updateDoc,
    addDoc,
    deleteDoc,
    serverTimestamp,
    orderBy,
    limit
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import {
    getStorage,
    ref,
    uploadBytes,
    getDownloadURL
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD8mSGezxer6j46O90_IsJOpUgu5KI0HnU",
    authDomain: "clubconnect-fc50f.firebaseapp.com",
    projectId: "clubconnect-fc50f",
    storageBucket: "clubconnect-fc50f.firebasestorage.app",
    messagingSenderId: "419240671350",
    appId: "1:419240671350:web:69f7113d686e7f3e4a8757",
    measurementId: "G-623LVNVKBG"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Common DOM refs
  const layoutEl      = document.getElementById("adminDashboardLayout");
  const emailLabel    = document.getElementById("adminEmailLabel");
  const avatarInitial = document.getElementById("adminAvatarInitial");
  const userNameLabel = document.getElementById("adminUserName");
  const logoutTopBtn  = document.getElementById("adminLogoutTopBtn");

  // === LEAGUES (realtime) ===
  const leaguesTableBody = document.querySelector("#leaguesTable tbody");

  function renderLeagueStatus(status) {
    switch (status) {
      case "live":
        return '<span class="status-pill status-pill--live"><i class="fas fa-circle"></i> Live</span>';
      case "completed":
        return '<span class="status-pill status-pill--completed"><i class="fas fa-flag-checkered"></i> Completed</span>';
      case "draft":
        return '<span class="status-pill status-pill--draft"><i class="fas fa-pen"></i> Draft</span>';
      default:
        return '<span class="status-pill status-pill--pending"><i class="fas fa-clock"></i> Enrollment</span>';
    }
  }

  function listenForLeagues() {
    if (!leaguesTableBody) return;

    const qLeagues = query(
      collection(db, "leagues"),
      orderBy("createdAt", "desc")
    );

    onSnapshot(qLeagues, (snapshot) => {
      leaguesTableBody.innerHTML = "";

      snapshot.forEach((docSnap) => {
        const l = docSnap.data();
        const tr = document.createElement("tr");
        tr.dataset.id = docSnap.id;

        tr.innerHTML = `
          <td>${l.name || "-"}</td>
          <td>${l.sport || "-"}</td>
          <td>${renderLeagueStatus(l.status)}</td>
          <td>${l.teamsCount ?? "—"}</td>
          <td>${l.startDateLabel || "-"}</td>
          <td>${l.sponsor || "-"}</td>
        `;

        leaguesTableBody.appendChild(tr);
      });
    });
  }

  // === PENDING PAYMENTS (realtime) ===
  const pendingPaymentsTableBody = document.getElementById("pendingPaymentsTableBody");

function listenForPendingPayments() {
  if (!pendingPaymentsTableBody) return;  // safety

  const q = query(
    collection(db, "users"),
    where("registrationPaid", "==", true),
    where("paymentStatus", "==", "pendingApproval")
  );

  onSnapshot(q, (snapshot) => {
    pendingPaymentsTableBody.innerHTML = "";
    snapshot.forEach((docSnap) => {
      const u = docSnap.data();
      const tr = document.createElement("tr");
      tr.dataset.userId = docSnap.id;

      // Check if it's a demo request
      const isDemoRequest = u.paymentType === "demo";
      const paymentBadge = isDemoRequest 
        ? '<span style="background: #f59e0b; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">DEMO</span>'
        : '<span style="background: #10b981; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600;">PAID</span>';

      tr.innerHTML = `
        <td>${u.fullName || "-"}</td>
        <td>${u.email || "-"}</td>
        <td>${u.role || "-"}</td>
        <td>${paymentBadge}</td>
        <td>${u.accountEnabled ? "Yes" : "No"}</td>
        <td>
          <div class="btn-row">
            <button class="btn-pill btn-pill-primary btn-approve-payment">
              <i class="fas fa-check"></i> Approve
            </button>
            <button class="btn-pill btn-pill-danger btn-reject-payment">
              <i class="fas fa-times"></i> Reject
            </button>
          </div>
        </td>
      `;
      pendingPaymentsTableBody.appendChild(tr);
    });
  });
}


if (pendingPaymentsTableBody) {
  pendingPaymentsTableBody.addEventListener("click", async (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const row = btn.closest("tr");
    const userId = row.dataset.userId;
    const userRef = doc(db, "users", userId);

    try {
      if (btn.classList.contains("btn-approve-payment")) {
        await updateDoc(userRef, {
          accountEnabled: true,
          paymentStatus: "approved"
        });
      } else if (btn.classList.contains("btn-reject-payment")) {
        await updateDoc(userRef, {
          registrationPaid: false,
          paymentStatus: "rejected"
        });
      }
    } catch (err) {
      console.error("Error updating payment status", err);
      showNotification("Could not update payment status.", 'error');
    }
  });
}


  // === VENUES (realtime + images) ===
  const venuesTable = document.getElementById("venuesTable");
  const addVenueBtn = document.getElementById("addVenueBtn");
  const venueImageInput = document.getElementById("venueImageInput");

  function listenForVenues() {
    if (!venuesTable) return;
    const tbody = venuesTable.querySelector("tbody");
    const qVenues = query(
      collection(db, "venues"),
      orderBy("createdAt", "desc")
    );

    onSnapshot(qVenues, (snapshot) => {
      tbody.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const v = docSnap.data();
        const tr = document.createElement("tr");

        const hasImage = v.imageUrl ? '<span class="badge-muted">Image</span>' : '<span class="badge-muted">-</span>';

        tr.innerHTML = `
          <td>${v.name || "-"}</td>
          <td>${v.city || "-"}</td>
          <td>${v.surface || "-"}</td>
          <td>${v.slotsPerDay || "-"}</td>
          <td>${hasImage}</td>
        `;
        tbody.appendChild(tr);
      });
    });
  }

  if (addVenueBtn) {
    addVenueBtn.addEventListener("click", async () => {
      const nameEl   = document.getElementById("venueNameInput");
      const cityEl   = document.getElementById("venueCityInput");
      const surfEl   = document.getElementById("venueSurfaceInput");
      const slotsEl  = document.getElementById("venueSlotsInput");

      const name  = nameEl.value.trim();
      const city  = cityEl.value.trim();
      const surf  = surfEl.value.trim();
      const slots = slotsEl.value.trim();

      if (!name || !city) {
        showNotification("Enter at least venue name and city.", 'warning');
        return;
      }

      addVenueBtn.disabled = true;
      addVenueBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding…';

      try {
        let imageUrl = null;

        const file = venueImageInput?.files?.[0];
        if (file) {
          const storageRef = ref(storage, `venueImages/${Date.now()}_${file.name}`);
          await uploadBytes(storageRef, file);
          imageUrl = await getDownloadURL(storageRef);
        }

        await addDoc(collection(db, "venues"), {
          name,
          city,
          surface: surf || null,
          slotsPerDay: slots ? Number(slots) : null,
          imageUrl,
          createdAt: serverTimestamp()
        });

        nameEl.value = "";
        cityEl.value = "";
        surfEl.value = "";
        slotsEl.value = "";
        if (venueImageInput) venueImageInput.value = "";

        showNotification("Venue added successfully.", 'success');
      } catch (err) {
        console.error("Error adding venue", err);
        showNotification("Could not add venue. Check console / Firestore rules.", 'error');
      } finally {
        addVenueBtn.disabled = false;
        addVenueBtn.innerHTML = '<i class="fas fa-plus"></i> Add venue';
      }
    });
  }

  // === CLUBS (realtime approval from owner profile updates) ===
  const clubsTable = document.getElementById("clubsTable");

  function listenForClubs() {
    if (!clubsTable) return;
    const tbody = clubsTable.querySelector("tbody");

    // owner dashboard should write to `clubs` collection when profile is saved
    // with fields: clubName, ownerName, ownerEmail, sport, status, ownerUid, city, updatedAt
    const qClubs = query(
      collection(db, "clubs"),
      orderBy("updatedAt", "desc")
    );

    onSnapshot(qClubs, (snapshot) => {
      tbody.innerHTML = "";
      snapshot.forEach((docSnap) => {
        const c = docSnap.data();
        const id = docSnap.id;

        const status = c.status || "pending";
        let statusHtml = "";
        let actionsHtml = "";

        if (status === "approved") {
          statusHtml = '<span class="status-pill status-pill--live"><i class="fas fa-check"></i> Active</span>';
          actionsHtml = `
            <div class="btn-row">
              <button class="btn-pill btn-pill-danger btn-suspend-club"><i class="fas fa-ban"></i> Suspend</button>
            </div>`;
        } else if (status === "pending") {
          statusHtml = '<span class="status-pill status-pill--pending"><i class="fas fa-clock"></i> Pending</span>';
          actionsHtml = `
            <div class="btn-row">
              <button class="btn-pill btn-pill-primary btn-approve-club"><i class="fas fa-check"></i> Approve</button>
              <button class="btn-pill btn-pill-danger btn-reject-club"><i class="fas fa-xmark"></i> Reject</button>
            </div>`;
        } else if (status === "suspended") {
          statusHtml = '<span class="status-pill status-pill--draft"><i class="fas fa-ban"></i> Suspended</span>';
          actionsHtml = `
            <button class="btn-pill btn-pill-primary btn-restore-club"><i class="fas fa-undo"></i> Restore</button>`;
        } else if (status === "rejected") {
          statusHtml = '<span class="status-pill status-pill--draft"><i class="fas fa-xmark"></i> Rejected</span>';
          actionsHtml = `
            <button class="btn-pill btn-pill-primary btn-restore-club"><i class="fas fa-undo"></i> Re-activate</button>`;
        }

        const tr = document.createElement("tr");
        tr.dataset.id = id;
        tr.innerHTML = `
          <td>${c.clubName || "-"}</td>
          <td>${c.ownerName || "-"}</td>
          <td>${c.sport || "-"}</td>
          <td>${statusHtml}</td>
          <td>${actionsHtml}</td>
        `;
        tbody.appendChild(tr);
      });
    });

    clubsTable.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const row = btn.closest("tr");
      if (!row) return;

      const clubId = row.dataset.id;
      const clubRef = doc(db, "clubs", clubId);

      try {
        if (btn.classList.contains("btn-approve-club")) {
          await updateDoc(clubRef, { status: "approved", updatedAt: serverTimestamp() });
        } else if (btn.classList.contains("btn-reject-club")) {
          await updateDoc(clubRef, { status: "rejected", updatedAt: serverTimestamp() });
        } else if (btn.classList.contains("btn-suspend-club")) {
          await updateDoc(clubRef, { status: "suspended", updatedAt: serverTimestamp() });
        } else if (btn.classList.contains("btn-restore-club")) {
          await updateDoc(clubRef, { status: "approved", updatedAt: serverTimestamp() });
        }
      } catch (err) {
        console.error("Error updating club status", err);
        showNotification("Could not update club status.", 'error');
      }
    });
  }

// === USERS (realtime, block/unblock) ===
const usersTable = document.getElementById("usersTable");
const usersTableBody = usersTable ? usersTable.querySelector("tbody") : null;
const userFilterButtons = document.querySelectorAll("[data-role-filter]");

let currentUserRoleFilter = "all";
let allUsersCache = [];

// render users table
function renderUsersTable() {
  if (!usersTableBody) return;
  usersTableBody.innerHTML = "";

  allUsersCache.forEach(({ id, data }) => {
    const u = data;

    if (currentUserRoleFilter !== "all" && u.role !== currentUserRoleFilter) {
      return;
    }

    const isBlocked = u.isBlocked === true;
    const statusLabel = isBlocked
      ? "Blocked"
      : (u.accountEnabled ? "Active" : "Disabled");

    const tr = document.createElement("tr");
    tr.dataset.uid = id;
    tr.dataset.role = u.role;
    tr.dataset.blocked = isBlocked ? "true" : "false";

    tr.innerHTML = `
      <td>${u.fullName || u.email}</td>
      <td>${u.role}</td>
      <td>${u.clubName || "—"}</td>
      <td><span class="badge-muted">${statusLabel}</span></td>
      <td>
        ${
          u.role === "super_admin"
            ? "—"
            : isBlocked
              ? `<button class="btn-pill btn-pill-primary btn-unblock-user">Unblock</button>`
              : `<button class="btn-pill btn-pill-danger btn-block-user">Block</button>`
        }
        ${
          u.role === "super_admin"
            ? ""
            : `<button class="btn-pill btn-pill-danger btn-delete-user">Delete</button>`
        }
      </td>
    `;

    usersTableBody.appendChild(tr);
  });
}

// realtime users listener
function listenForUsers() {
  const qUsers = query(collection(db, "users"));
  onSnapshot(qUsers, (snap) => {
    allUsersCache = [];
    snap.forEach((docSnap) => {
      allUsersCache.push({ id: docSnap.id, data: docSnap.data() });
    });
    renderUsersTable();
  });
}

// user actions
if (usersTableBody) {
  usersTableBody.addEventListener("click", async (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;

    const row = btn.closest("tr");
    const uid = row.dataset.uid;
    const userRef = doc(db, "users", uid);

    try {
      if (btn.classList.contains("btn-block-user")) {
        await updateDoc(userRef, { isBlocked: true, accountEnabled: false });
      }

      if (btn.classList.contains("btn-unblock-user")) {
        await updateDoc(userRef, { isBlocked: false });
      }

      if (btn.classList.contains("btn-delete-user")) {
        showConfirm("Delete user permanently?", async () => {
          try {
            await deleteDoc(userRef);
            showNotification("User deleted permanently.", 'success');
          } catch (err) {
            console.error("Error deleting user:", err);
            showNotification("Could not delete user.", 'error');
          }
        });
        return;
      }
    } catch (err) {
      console.error("Error updating user:", err);
      showNotification("Could not update user.", 'error');
    }
  });
}

// role filter
userFilterButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    currentUserRoleFilter = btn.dataset.roleFilter;
    userFilterButtons.forEach(b => b.classList.remove("btn-pill-primary"));
    btn.classList.add("btn-pill-primary");
    renderUsersTable();
  });
});


  // === REVENUE (Chart.js + realtime from payments) ===
  let revenueChart = null;
  const revCanvas = document.getElementById("revenueChart");

  if (revCanvas) {
    const ctx = revCanvas.getContext("2d");
    revenueChart = new Chart(ctx, {
      type: "line",
      data: {
        labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
        datasets: [
          {
            label: "Revenue (PKR)",
            data: Array(12).fill(0),
            borderColor: "#155598",
            backgroundColor: "rgba(21,85,152,0.18)",
            tension: 0.35,
            fill: true,
            yAxisID: "y"
          },
          {
            label: "Paid registrations",
            data: Array(12).fill(0),
            borderColor: "#218081",
            backgroundColor: "rgba(33,128,129,0.18)",
            tension: 0.35,
            yAxisID: "y1"
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          y: {
            beginAtZero: true,
            grid: { color: "rgba(0,0,0,0.05)" },
            ticks: { color: "#4b5563", font: { size: 10 } }
          },
          y1: {
            position: "right",
            beginAtZero: true,
            grid: { drawOnChartArea: false },
            ticks: { color: "#4b5563", font: { size: 10 } }
          },
          x: {
            grid: { color: "rgba(0,0,0,0.04)" },
            ticks: { color: "#4b5563", font: { size: 10 } }
          }
        }
      }
    });
  }

  function listenForRevenue() {
    if (!revenueChart) return;

    const qPayments = query(
      collection(db, "payments"),
      orderBy("createdAt", "asc")
    );

    onSnapshot(qPayments, (snapshot) => {
      const revenueByMonth = Array(12).fill(0);
      const registrationsByMonth = Array(12).fill(0);

      snapshot.forEach((docSnap) => {
        const p = docSnap.data();
        const ts = p.createdAt?.toDate ? p.createdAt.toDate() : null;
        if (!ts) return;

        const monthIndex = ts.getMonth(); // 0-11
        const amount = Number(p.amount || 0);

        revenueByMonth[monthIndex] += amount;

        // if payment type is registration, count it
        if (p.type === "registration") {
          registrationsByMonth[monthIndex] += 1;
        }
      });

      revenueChart.data.datasets[0].data = revenueByMonth;
      revenueChart.data.datasets[1].data = registrationsByMonth;
      revenueChart.update();
    });
  }

  // === COMPLAINTS / CONTACT (realtime from contactMessages) ===
  const complaintsList = document.getElementById("complaintsList");

  function listenForComplaints() {
    if (!complaintsList) return;

      const qComplaints = query(
    collection(db, "contactRequests"), // 🔴 same as rules + contact page
    orderBy("createdAt", "desc"),
    limit(30)
  );


    onSnapshot(qComplaints, (snapshot) => {
      complaintsList.innerHTML = "";

      snapshot.forEach((docSnap) => {
        const c = docSnap.data();
        const id = docSnap.id;

        const status = c.status || "open";
        const isResolved = status === "resolved";

        const timeStr = c.createdAt?.toDate
          ? c.createdAt.toDate().toLocaleString()
          : "";

        const roleLabel = c.role || "User";
        const severity = c.severity || "Normal";

        const li = document.createElement("li");
        li.className = "complaint-item";
        li.dataset.id = id;
        li.dataset.status = status;

        li.innerHTML = `
          <div class="complaint-main">
            <strong>${roleLabel} · ${c.name || c.email || "Anonymous"}</strong> – "${c.subject || "Contact"}"
            <div class="complaint-meta">
              ${c.message || ""}<br>
              From: ${c.email || "n/a"} • ${timeStr} • Severity: ${severity}
            </div>
          </div>
          <div class="complaint-actions">
            ${
              isResolved
                ? '<span class="badge-muted">Resolved</span>'
                : `
                    <button class="btn-pill btn-pill-primary btn-mark-resolved">
                      <i class="fas fa-check"></i> Mark resolved
                    </button>
                    <button class="btn-pill btn-pill-ghost btn-escalate">
                      <i class="fas fa-arrow-up-right-from-square"></i> Escalate
                    </button>
                  `
            }
          </div>
        `;

        complaintsList.appendChild(li);
      });
    });

    complaintsList.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const item = btn.closest(".complaint-item");
      if (!item) return;

      const id = item.dataset.id;
      const compRef = doc(db, "contactMessages", id);

      try {
        if (btn.classList.contains("btn-mark-resolved")) {
          await updateDoc(compRef, { status: "resolved" });
        } else if (btn.classList.contains("btn-escalate")) {
          await updateDoc(compRef, { escalated: true });
          showNotification("Escalated (you can handle this field however you like later).", 'info', 5000);
        }
      } catch (err) {
        console.error("Error updating complaint", err);
        showNotification("Could not update complaint status.", 'error');
      }
    });
  }

  // === AUTH GUARD + INIT ===
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    try {
      const snap = await getDoc(doc(db, "users", user.uid));
      if (!snap.exists()) {
        window.location.href = "login.html";
        return;
      }
      const data = snap.data();

      // only super admin
      if (data.role !== "super_admin") {
        window.location.href = "login.html";
        return;
      }

      if (layoutEl) layoutEl.style.display = "grid";

      const email = user.email || "superadmin@clubconnect.com";
      if (emailLabel) emailLabel.textContent = email;

      const name = data.fullName || "Super Admin";
      if (userNameLabel) userNameLabel.textContent = name;

      if (avatarInitial) {
        const init = name.split(" ").map(p => p[0]).join("").slice(0, 2).toUpperCase();
        avatarInitial.textContent = init || "SA";
      }

      // start all realtime listeners
      listenForPendingPayments();
      listenForLeagues();
      listenForVenues();
      listenForClubs();
      listenForUsers();
      listenForRevenue();
      listenForComplaints();

    } catch (err) {
      console.error("Error loading admin profile", err);
      window.location.href = "login.html";
    }
  });

  async function doLogout() {
    try {
      await signOut(auth);
    } catch (e) {
      console.error(e);
    } finally {
      window.location.href = "login.html";
    }
  }

  if (logoutTopBtn) {
    logoutTopBtn.addEventListener("click", doLogout);
  }

  // Sidebar view switching
  const sidebarLinks = document.querySelectorAll(".sidebar-link");
  const views = document.querySelectorAll(".view");

  sidebarLinks.forEach(link => {
    link.addEventListener("click", () => {
      const target = link.getAttribute("data-view-target");
      sidebarLinks.forEach(l => l.classList.remove("active"));
      link.classList.add("active");
      views.forEach(v => {
        v.classList.toggle("active", v.id === "view-" + target);
      });
    });
  });

  // League creation (same as before, but using Firestore)
  const createLeagueBtn = document.getElementById("createLeagueBtn");

  if (createLeagueBtn) {
    createLeagueBtn.addEventListener("click", async () => {
      const nameEl     = document.getElementById("leagueNameInput");
      const sportEl    = document.getElementById("leagueSportSelect");
      const startEl    = document.getElementById("leagueStartDate");
      const deadlineEl = document.getElementById("leagueDeadline");
      const sponsorEl  = document.getElementById("leagueSponsorInput");
      const notesEl    = document.getElementById("leagueNotes");

      const name     = nameEl.value.trim();
      const sport    = sportEl.value;
      const start    = startEl.value;
      const deadline = deadlineEl.value;
      const sponsor  = sponsorEl.value.trim();
      const notes    = notesEl.value.trim();

      if (!name || !sport || !start || !deadline) {
        showNotification("Please fill league name, sport, start date and enrollment deadline.", 'warning', 5000);
        return;
      }

      createLeagueBtn.disabled = true;
      createLeagueBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating…';

      try {
        const user = auth.currentUser;

        const startLabel = new Date(start).toLocaleDateString("en-GB", {
          month: "short",
          day: "2-digit"
        });
        const deadlineLabel = new Date(deadline).toLocaleDateString("en-GB", {
          month: "short",
          day: "2-digit"
        });

        await addDoc(collection(db, "leagues"), {
          name,
          sport,
          sponsor: sponsor || null,
          notes: notes || null,
          startDate: start,
          deadline: deadline,
          startDateLabel: startLabel,
          deadlineLabel: deadlineLabel,
          status: "enrollment",
          teamsCount: 0,
          createdAt: serverTimestamp(),
          createdBy: user ? user.uid : null
        });

        nameEl.value = "";
        sportEl.value = "";
        startEl.value = "";
        deadlineEl.value = "";
        sponsorEl.value = "";
        notesEl.value = "";

        showNotification("League created. Club owners will see it instantly in their dashboard.", 'success', 5000);
      } catch (err) {
        console.error("Error creating league", err);
        showNotification("Could not create league. Check console / Firestore rules.", 'error');
      } finally {
        createLeagueBtn.disabled = false;
        createLeagueBtn.innerHTML = '<i class="fas fa-plus-circle"></i> Create league';
      }
    });
  }
</script>

</body>
</html>
